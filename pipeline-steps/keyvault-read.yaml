parameters:
  serviceConnection: ''
  keyvaultName: ''
  environment: ''

steps:

  - template: steps/keyvault-read.yaml@cnp-azuredevops-libraries
    parameters:
      serviceConnection: ${{ parameters.serviceConnection }}
      environment: ${{ parameters.environment }}

  - task: AzureKeyVault@1
    displayName: 'Get Secrets from KeyVault'
    inputs:
      azureSubscription: ${{ parameters.serviceConnection }}
      keyVaultName: $(controlKeyVault)
      secretsFilter: 'sp-application-id,sp-token'

  - script: |
      echo '##vso[task.setvariable variable=ARM_CLIENT_ID]$(sp-application-id)'
      echo '##vso[task.setvariable variable=ARM_CLIENT_SECRET]$(sp-token)'
    displayName: 'Export Keyvault Variables'
    name: SetSubscriptionSP
