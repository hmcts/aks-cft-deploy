parameters:
  environment: ''
  location: ''
  serviceConnection: ''
  stack: ''
  project: ''
  tfversion: ''
  tfInitSub: ''
  builtFrom: ''
  product: ''

steps:

  - script: rm -fr .terraform/modules/${{ parameters.stack }}

  - template: steps/terraform.yaml@cnp-azuredevops-libraries
    parameters:
      overrideAction: $(action)
      environment: ${{ parameters.environment }}
      component: ${{ parameters.stack }}
      serviceConnection: $(serviceConnection)
      terraformInitSubscription: ${{ variables.tfInitSub }}
      product: ${{ variables.product }}
      initCommandOptions: "-backend-config resource_group_name=${{ variables.backendAzureRmResourceGroupName }}"
      planCommandOptions: >
        -var subscription_id=$(ARM_SUBSCRIPTION_ID)
        -var environment=${{ parameters.environment }}
